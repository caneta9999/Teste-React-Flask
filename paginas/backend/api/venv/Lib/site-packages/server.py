from flask import Flask
from flask import jsonify
from flask import request
from flask import redirect
import datetime
import time
import sqlite3
app = Flask(__name__)

conector = sqlite3.connect("visitantes.db")
cursor = conector.cursor()
'''dados = [('AndrÃ©', 18, 'SP', datetime.date.today()),
  ('Marcos',20,'SP',datetime.date.today()),
  ('Maria',22,'MG',datetime.date.today()),
  ('Eduarda',55,'RJ',datetime.date.today())]
for d in dados:
    sql = "insert into visitante (Nome,Idade,Estado,DataVisita) values (" + '"' + d[0] + '"' + ',' + str(d[1]) + ',' + '"' + d[2] + '"' + ',' + '"' + str(d[3]) + '"' + ')'
    print(sql)
    cursor.execute(sql)
conector.commit()'''

sql = "select Nome,Idade,Estado,DataVisita from visitante order by Codigo desc Limit 10"
cursor.execute(sql)
visitantes = cursor.fetchall()
@app.route('/visitantes')
def get_visitantes():
    return jsonify({'visitantes': visitantes})
    
@app.route('/form', methods = ['POST'])
def form():
    conector2 = sqlite3.connect("visitantes.db")
    cursor2 = conector2.cursor()
    data = {'nome': request.form['nomeInput'], 'idade': request.form['idadeInput'], 'estado': request.form['estadoSelect']}
    if((any(char.isdigit() for char in data['nome'])) or len(data['nome']) > 100 or len(data['nome']) < 1):
        data['nome'] = 'Antonio'
    if((not data['idade'].isdigit()) or len(data)>3 or len(data)<1):
        data['idade'] = '1'
    if(data['estado'] not in ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO']):
        data['estado'] = 'SP'
    sql2 = "insert into visitante (Nome,Idade,Estado,DataVisita) values (" + '"' + data['nome'] + '"' + ',' + data['idade'] + ',' + '"' + data['estado'] + '"' + ',' + '"' + str(datetime.date.today()) + '"' + ')'
    cursor2.execute(sql2)
    conector2.commit()
    return redirect("http://localhost:3000/")
if __name__ == '__main__':
   app.run(debug=True)
